<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Kilogrid: src/kilob/kilob_wall_avoidance.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kilogrid
   </div>
   <div id="projectbrief">Kilogrid library documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('kilob__wall__avoidance_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">kilob_wall_avoidance.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="kilob__wall__avoidance_8h_source.html">kilob_wall_avoidance.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kilo__rand__lib_8h_source.html">kilo_rand_lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ringbuffer_8h_source.html">ringbuffer.h</a>&quot;</code><br />
<code>#include &quot;utils.h&quot;</code><br />
</div>
<p><a href="kilob__wall__avoidance_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a47c76ac3e84eaa85f8f4eca24e3b58ed"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kilob__wall__avoidance_8c.html#a47c76ac3e84eaa85f8f4eca24e3b58ed">kilob_wall_avoidance_state_t</a> { <a class="el" href="kilob__wall__avoidance_8c.html#a47c76ac3e84eaa85f8f4eca24e3b58edaabeabcfac36de28dace79e70daa36983">KILOB_WALL_AVOIDANCE_IDLE</a> = 0x00, 
<a class="el" href="kilob__wall__avoidance_8c.html#a47c76ac3e84eaa85f8f4eca24e3b58eda64dbc07839d470acc01588f54b719772">KILOB_WALL_AVOIDANCE_INIT</a>, 
<a class="el" href="kilob__wall__avoidance_8c.html#a47c76ac3e84eaa85f8f4eca24e3b58eda8b71b9ab9716f598f0406b3edc449ff8">KILOB_WALL_AVOIDANCE_ROTATION</a>, 
<a class="el" href="kilob__wall__avoidance_8c.html#a47c76ac3e84eaa85f8f4eca24e3b58eda6dbf9340c9c1f3035432a0873d0027ef">KILOB_WALL_AVOIDANCE_ESCAPE</a>
 }</td></tr>
<tr class="separator:a47c76ac3e84eaa85f8f4eca24e3b58ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4bf1a16ad332f2acf046a2a22a2eaee5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kilob__wall__avoidance_8c.html#a4bf1a16ad332f2acf046a2a22a2eaee5">RB_create</a> (wall_readings_buffer, <a class="el" href="structdistance__measurement__t.html">distance_measurement_t</a>, <a class="el" href="kilob__wall__avoidance_8h.html#a55b03c98ac9c7b303b26dcae6253fd1e">WALL_READINGS_BUFFER_SIZE</a>)</td></tr>
<tr class="memdesc:a4bf1a16ad332f2acf046a2a22a2eaee5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer used to store the distance readings when receiving messages from wall subcells.  <a href="#a4bf1a16ad332f2acf046a2a22a2eaee5">More...</a><br /></td></tr>
<tr class="separator:a4bf1a16ad332f2acf046a2a22a2eaee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f405d156a31aa874ef82cce818bd1e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kilob__wall__avoidance_8c.html#a2f405d156a31aa874ef82cce818bd1e8">kilob_wall_avoidance_init</a> ()</td></tr>
<tr class="separator:a2f405d156a31aa874ef82cce818bd1e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade1ad73822e391c52a7ef27c0d291fb2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kilob__wall__avoidance_8c.html#ade1ad73822e391c52a7ef27c0d291fb2">kilob_on_wall_detected</a> (<a class="el" href="structdistance__measurement__t.html">distance_measurement_t</a> *wall_dist, <a class="el" href="struct_i_r__message__t.html">IR_message_t</a> *wall_msg)</td></tr>
<tr class="memdesc:ade1ad73822e391c52a7ef27c0d291fb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when a wall is detected. Sets the kilob_wa_wall_detected state variable and refreshes the kilob_wa_wall_detected_timeout.  <a href="#ade1ad73822e391c52a7ef27c0d291fb2">More...</a><br /></td></tr>
<tr class="separator:ade1ad73822e391c52a7ef27c0d291fb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4fd3a6b4fbf9b90b7ae200a9feb9630"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kilob__wall__avoidance_8c.html#af4fd3a6b4fbf9b90b7ae200a9feb9630">kilob_wall_avoidance</a> ()</td></tr>
<tr class="memdesc:af4fd3a6b4fbf9b90b7ae200a9feb9630"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements wall avoidance for the kilobot. Should be called from the main loop() function.  <a href="#af4fd3a6b4fbf9b90b7ae200a9feb9630">More...</a><br /></td></tr>
<tr class="separator:af4fd3a6b4fbf9b90b7ae200a9feb9630"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a492fdf6c0ef065ff013720513f69e8f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kilob__wall__avoidance_8c.html#a492fdf6c0ef065ff013720513f69e8f4">kilob_wall_avoidance_reset</a> ()</td></tr>
<tr class="memdesc:a492fdf6c0ef065ff013720513f69e8f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the state to KILOB_WALL_AVOIDANCE_INIT. The rest of the initialization is done in <a class="el" href="kilob__wall__avoidance_8c.html#af4fd3a6b4fbf9b90b7ae200a9feb9630" title="Implements wall avoidance for the kilobot. Should be called from the main loop() function. ">kilob_wall_avoidance()</a>.  <a href="#a492fdf6c0ef065ff013720513f69e8f4">More...</a><br /></td></tr>
<tr class="separator:a492fdf6c0ef065ff013720513f69e8f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0d93758d65676f8ba5400387a26b92ca"><td class="memItemLeft" align="right" valign="top">volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kilob__wall__avoidance_8c.html#a0d93758d65676f8ba5400387a26b92ca">previous_wall_reading</a> = 0</td></tr>
<tr class="memdesc:a0d93758d65676f8ba5400387a26b92ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Previous wall reading.  <a href="#a0d93758d65676f8ba5400387a26b92ca">More...</a><br /></td></tr>
<tr class="separator:a0d93758d65676f8ba5400387a26b92ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a47c76ac3e84eaa85f8f4eca24e3b58ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kilob__wall__avoidance_8c.html#a47c76ac3e84eaa85f8f4eca24e3b58ed">kilob_wall_avoidance_state_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a47c76ac3e84eaa85f8f4eca24e3b58edaabeabcfac36de28dace79e70daa36983"></a>KILOB_WALL_AVOIDANCE_IDLE&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a47c76ac3e84eaa85f8f4eca24e3b58eda64dbc07839d470acc01588f54b719772"></a>KILOB_WALL_AVOIDANCE_INIT&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a47c76ac3e84eaa85f8f4eca24e3b58eda8b71b9ab9716f598f0406b3edc449ff8"></a>KILOB_WALL_AVOIDANCE_ROTATION&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a47c76ac3e84eaa85f8f4eca24e3b58eda6dbf9340c9c1f3035432a0873d0027ef"></a>KILOB_WALL_AVOIDANCE_ESCAPE&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="kilob__wall__avoidance_8c_source.html#l00006">6</a> of file <a class="el" href="kilob__wall__avoidance_8c_source.html">kilob_wall_avoidance.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ade1ad73822e391c52a7ef27c0d291fb2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void kilob_on_wall_detected </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdistance__measurement__t.html">distance_measurement_t</a> *&#160;</td>
          <td class="paramname"><em>wall_dist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_i_r__message__t.html">IR_message_t</a> *&#160;</td>
          <td class="paramname"><em>wall_msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called when a wall is detected. Sets the kilob_wa_wall_detected state variable and refreshes the kilob_wa_wall_detected_timeout. </p>

<p>Definition at line <a class="el" href="kilob__wall__avoidance_8c_source.html#l00123">123</a> of file <a class="el" href="kilob__wall__avoidance_8c_source.html">kilob_wall_avoidance.c</a>.</p>

</div>
</div>
<a class="anchor" id="af4fd3a6b4fbf9b90b7ae200a9feb9630"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t kilob_wall_avoidance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements wall avoidance for the kilobot. Should be called from the main loop() function. </p>
<p>The function first checks if any wall was detected in the last WA_WALL_DETECTED_TIMEOUT milliseconds. If not, it sets the kilob_wa_wall_detected state variable to false and wall avoidance is finished. The details of the states are as follows:</p>
<ul>
<li>KILOB_WALL_AVOIDANCE_INIT and any other state not detailed here: This is the entry state, it initializes a timeout and a direction to turn the kilobot. The next state is KILOB_WALL_AVOIDANCE_ROTATION.</li>
<li>KILOB_WALL_AVOIDANCE_ROTATION: The kilobot rotates in this state until the timeout is reached. It sets the next timeout for escaping from the wall, starts the movement straight and goes to the state KILOB_WALL_AVOIDANCE_ESCAPE.</li>
<li>KILOB_WALL_AVOIDANCE_ESCAPE: Waits for the timeout and goes back to the KILOB_WALL_AVOIDANCE_INIT for reinitalization.</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>true if the wall avoidance is still running, false if the wall was avoided. </dd></dl>

<p>Definition at line <a class="el" href="kilob__wall__avoidance_8c_source.html#l00163">163</a> of file <a class="el" href="kilob__wall__avoidance_8c_source.html">kilob_wall_avoidance.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2f405d156a31aa874ef82cce818bd1e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kilob_wall_avoidance_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kilob__wall__avoidance_8c_source.html#l00080">80</a> of file <a class="el" href="kilob__wall__avoidance_8c_source.html">kilob_wall_avoidance.c</a>.</p>

</div>
</div>
<a class="anchor" id="a492fdf6c0ef065ff013720513f69e8f4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void kilob_wall_avoidance_reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resets the state to KILOB_WALL_AVOIDANCE_INIT. The rest of the initialization is done in <a class="el" href="kilob__wall__avoidance_8c.html#af4fd3a6b4fbf9b90b7ae200a9feb9630" title="Implements wall avoidance for the kilobot. Should be called from the main loop() function. ">kilob_wall_avoidance()</a>. </p>

<p>Definition at line <a class="el" href="kilob__wall__avoidance_8c_source.html#l00275">275</a> of file <a class="el" href="kilob__wall__avoidance_8c_source.html">kilob_wall_avoidance.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4bf1a16ad332f2acf046a2a22a2eaee5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RB_create </td>
          <td>(</td>
          <td class="paramtype">wall_readings_buffer&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdistance__measurement__t.html">distance_measurement_t</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kilob__wall__avoidance_8h.html#a55b03c98ac9c7b303b26dcae6253fd1e">WALL_READINGS_BUFFER_SIZE</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Buffer used to store the distance readings when receiving messages from wall subcells. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a0d93758d65676f8ba5400387a26b92ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint32_t previous_wall_reading = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Previous wall reading. </p>

<p>Definition at line <a class="el" href="kilob__wall__avoidance_8c_source.html#l00076">76</a> of file <a class="el" href="kilob__wall__avoidance_8c_source.html">kilob_wall_avoidance.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
