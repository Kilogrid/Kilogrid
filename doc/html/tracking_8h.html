<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Kilogrid: src/common/kilogui_dispatcher/tracking.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kilogrid
   </div>
   <div id="projectbrief">Kilogrid library documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tracking_8h.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tracking.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_c_a_n_8h_source.html">CAN.h</a>&quot;</code><br />
<code>#include &quot;stdint.h&quot;</code><br />
<code>#include &quot;<a class="el" href="serial__packet_8h_source.html">serial_packet.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kilogrid_8h_source.html">kilogrid.h</a>&quot;</code><br />
</div>
<p><a href="tracking_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a850715da45c16d8e419715dfc51a60da"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8h.html#a850715da45c16d8e419715dfc51a60da">TRACKING_ITEM_BUFFER_SIZE</a>&#160;&#160;&#160;40</td></tr>
<tr class="memdesc:a850715da45c16d8e419715dfc51a60da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of messages in the buffer that triggers message sending to the pc.  <a href="#a850715da45c16d8e419715dfc51a60da">More...</a><br /></td></tr>
<tr class="separator:a850715da45c16d8e419715dfc51a60da"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad09246453a4dabd919c7541484046a87"><td class="memItemLeft" align="right" valign="top">struct&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8h.html#ad09246453a4dabd919c7541484046a87">__attribute__</a> ((__packed__))</td></tr>
<tr class="memdesc:ad09246453a4dabd919c7541484046a87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format of the serial packet containing tracking data. The header and checksum are the same as a serial_packet_raw_t struct.  <a href="#ad09246453a4dabd919c7541484046a87">More...</a><br /></td></tr>
<tr class="separator:ad09246453a4dabd919c7541484046a87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03ee629435ead826ee695093a747fce7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8h.html#a03ee629435ead826ee695093a747fce7">tracking_message_received</a> (<a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a> address, uint8_t cell, <a class="el" href="kilogrid_8h.html#a076098c0af2ea2c910e2e870dfb07091">tracking_user_data_t</a> *data)</td></tr>
<tr class="memdesc:a03ee629435ead826ee695093a747fce7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called from CAN received interrupt, copies the message to the buffer and sets the address and timestamp fields.  <a href="#a03ee629435ead826ee695093a747fce7">More...</a><br /></td></tr>
<tr class="separator:a03ee629435ead826ee695093a747fce7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af417467184692afe72e0557b2e305f33"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8h.html#af417467184692afe72e0557b2e305f33">tracking_try_send</a> (uint8_t)</td></tr>
<tr class="memdesc:af417467184692afe72e0557b2e305f33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that handles the sending of tracking messages to the pc. Serial packets are slow, therefore we only send at certain intervals (PACKET_SEND_TIMEOUT) or when the buffer has TRACKING_ITEM_SEND_TRIGGER messages stored. The reason for the latter is that we cannot predict the rate of the incoming tracking messages precisely and want to minimize the chance of dropping messages because the buffer is full. force_dump: force dump serial packet data if equal to 1.  <a href="#af417467184692afe72e0557b2e305f33">More...</a><br /></td></tr>
<tr class="separator:af417467184692afe72e0557b2e305f33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8298940cdd3a6b583a6b9509903925b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8h.html#a8298940cdd3a6b583a6b9509903925b3">tracking_init</a> (uint8_t)</td></tr>
<tr class="separator:a8298940cdd3a6b583a6b9509903925b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a68f76bb63f54fb3b508d99f75589615a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8h.html#a68f76bb63f54fb3b508d99f75589615a">tracking_item_t</a></td></tr>
<tr class="separator:a68f76bb63f54fb3b508d99f75589615a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04dd7d24dc08aa42aac67838fc9a73fe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8h.html#a04dd7d24dc08aa42aac67838fc9a73fe">serial_packet_tracking_t</a></td></tr>
<tr class="separator:a04dd7d24dc08aa42aac67838fc9a73fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a850715da45c16d8e419715dfc51a60da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRACKING_ITEM_BUFFER_SIZE&#160;&#160;&#160;40</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Number of messages in the buffer that triggers message sending to the pc. </p>

<p>Definition at line <a class="el" href="tracking_8h_source.html#l00013">13</a> of file <a class="el" href="tracking_8h_source.html">tracking.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ad09246453a4dabd919c7541484046a87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(__packed__)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format of the serial packet containing tracking data. The header and checksum are the same as a serial_packet_raw_t struct. </p>

<p>Definition at line <a class="el" href="tracking_8h_source.html#l00028">28</a> of file <a class="el" href="tracking_8h_source.html">tracking.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8298940cdd3a6b583a6b9509903925b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tracking_init </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="tracking_8c_source.html#l00060">60</a> of file <a class="el" href="tracking_8c_source.html">tracking.c</a>.</p>

</div>
</div>
<a class="anchor" id="a03ee629435ead826ee695093a747fce7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tracking_message_received </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a>&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>cell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kilogrid_8h.html#a076098c0af2ea2c910e2e870dfb07091">tracking_user_data_t</a> *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called from CAN received interrupt, copies the message to the buffer and sets the address and timestamp fields. </p>
<p>  </p>

<p>Definition at line <a class="el" href="tracking_8c_source.html#l00071">71</a> of file <a class="el" href="tracking_8c_source.html">tracking.c</a>.</p>

</div>
</div>
<a class="anchor" id="af417467184692afe72e0557b2e305f33"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t tracking_try_send </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>force_dump</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function that handles the sending of tracking messages to the pc. Serial packets are slow, therefore we only send at certain intervals (PACKET_SEND_TIMEOUT) or when the buffer has TRACKING_ITEM_SEND_TRIGGER messages stored. The reason for the latter is that we cannot predict the rate of the incoming tracking messages precisely and want to minimize the chance of dropping messages because the buffer is full. force_dump: force dump serial packet data if equal to 1. </p>
<p>First it saves the current state: timestamp and message_counter. Then sends the data back to the pc. To finish up it moves all messages received in the meantime to the beginning of the tracking_items_buffer.</p>
<p>Sent message structure is as follows:</p>
<p>SERIAL_PACKET_HEADER 1 byte type: SERIAL_PACKET_TRACKING 1 byte total length of the data in bytes 1 byte base timestamp 4 bytes tracking messages n * sizeof(tracking_item_t) checksum 1 byte </p>

<p>Definition at line <a class="el" href="tracking_8c_source.html#l00044">44</a> of file <a class="el" href="tracking_8c_source.html">tracking.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a04dd7d24dc08aa42aac67838fc9a73fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">serial_packet_tracking_t</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="tracking_8h_source.html#l00058">58</a> of file <a class="el" href="tracking_8h_source.html">tracking.h</a>.</p>

</div>
</div>
<a class="anchor" id="a68f76bb63f54fb3b508d99f75589615a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tracking_item_t</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="tracking_8h_source.html#l00039">39</a> of file <a class="el" href="tracking_8h_source.html">tracking.h</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
