<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Kilogrid: src/common/dispatcher_module/CAN.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kilogrid
   </div>
   <div id="projectbrief">Kilogrid library documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_c_a_n_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">CAN.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;avr/interrupt.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_c_a_n_8h_source.html">CAN.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mcp2515_8h_source.html">mcp2515.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mcp2515__defs_8h_source.html">mcp2515_defs.h</a>&quot;</code><br />
<code>#include &quot;stdint.h&quot;</code><br />
<code>#include &quot;stdlib.h&quot;</code><br />
<code>#include &quot;<a class="el" href="common_2dispatcher__module_2debug_8h_source.html">debug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="common_2dispatcher__module_2utils_8h_source.html">utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kilogrid_8h_source.html">kilogrid.h</a>&quot;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div>
<p><a href="_c_a_n_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa4c80db50b8633f374bfc84d9b54e51a"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#aa4c80db50b8633f374bfc84d9b54e51a">get_CAN_ID_from_Kilogrid_address</a> (<a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a> coord, <a class="el" href="kilogrid_8h.html#a9f1df68876fd842a165e4874cef1c85e">destination_type_t</a> dest_type)</td></tr>
<tr class="memdesc:aa4c80db50b8633f374bfc84d9b54e51a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute CAN ID based on the type of addressing, destination type (type of node to reach) and coordinates of the CAN node in Kilogrid. The ID field of a CAN message encodes the coordinates of the module in Kilogrid in the following manner: ID&lt;10:0&gt; = [y&lt;4:0&gt; + 1][x&lt;4:0&gt; + 1][destination_type_t] For example, when accessing module with coordinates (x = 0, y = 0) with individual addressing, ID&lt;10:0&gt; = 00001 00001 0. Zeros in the ID field are reserved for broadcasting to allmodules (00000 00000 0), modules in a row (yyyyy 00000 0), or modules in a column (00000 xxxxx 0).  <a href="#aa4c80db50b8633f374bfc84d9b54e51a">More...</a><br /></td></tr>
<tr class="separator:aa4c80db50b8633f374bfc84d9b54e51a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a067b77d8e8a39f19e9d6b2ffdeaa3b1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#a067b77d8e8a39f19e9d6b2ffdeaa3b1e">init_CAN_message</a> (<a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *m)</td></tr>
<tr class="separator:a067b77d8e8a39f19e9d6b2ffdeaa3b1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84c20fe632d11f5e754c7dddbaa8b4ed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#a84c20fe632d11f5e754c7dddbaa8b4ed">init_module_CAN</a> (uint8_t x_coord, uint8_t y_coord)</td></tr>
<tr class="separator:a84c20fe632d11f5e754c7dddbaa8b4ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20158adb7f4c3d35c7b0f5cf19e84d2e"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#a20158adb7f4c3d35c7b0f5cf19e84d2e">CAN_message_tx</a> (<a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *message, <a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a> dest)</td></tr>
<tr class="memdesc:a20158adb7f4c3d35c7b0f5cf19e84d2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function modifies the ID field of the CAN message to be sent, according to the Kilogrid addressing scheme.  <a href="#a20158adb7f4c3d35c7b0f5cf19e84d2e">More...</a><br /></td></tr>
<tr class="separator:a20158adb7f4c3d35c7b0f5cf19e84d2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75fac9f8d6e033dd6acafeece87a642a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#a75fac9f8d6e033dd6acafeece87a642a">get_coord_from_CAN_ID</a> (<a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *m)</td></tr>
<tr class="separator:a75fac9f8d6e033dd6acafeece87a642a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c4253df4d3cec6ede0b9159d5ceb7d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#a6c4253df4d3cec6ede0b9159d5ceb7d9">serialize_tracking_message</a> (<a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *msg, uint8_t cell_id, <a class="el" href="kilogrid_8h.html#a076098c0af2ea2c910e2e870dfb07091">tracking_user_data_t</a> *data)</td></tr>
<tr class="memdesc:a6c4253df4d3cec6ede0b9159d5ceb7d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serialize CAN tracking message struct into a CAN message. The data contained in the former will be compressed according to the number of bits required for each field, and assigned to the data field of the CAN message. Note that the rest of the fields in the data message (e.g. address field) will remain untouched.  <a href="#a6c4253df4d3cec6ede0b9159d5ceb7d9">More...</a><br /></td></tr>
<tr class="separator:a6c4253df4d3cec6ede0b9159d5ceb7d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa7c8bf5218a1834d935af8389e937593"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_c_a_n_8h.html#ab7565ef31c096c131e47a054c1781bc6">CAN_message_rx_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#aa7c8bf5218a1834d935af8389e937593">module_CAN_message_rx</a></td></tr>
<tr class="separator:aa7c8bf5218a1834d935af8389e937593"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c8192f63e3faf60e348e3ea69bd6a08"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_c_a_n_8h.html#a297b7efa86f3572af1cbb4a21216defe">CAN_message_tx_success_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#a7c8192f63e3faf60e348e3ea69bd6a08">module_CAN_message_tx_success</a></td></tr>
<tr class="separator:a7c8192f63e3faf60e348e3ea69bd6a08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad376db0d7e809a8cc13d4618f90ba944"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_c_a_n_8c.html#ad376db0d7e809a8cc13d4618f90ba944">CAN_rx_message</a></td></tr>
<tr class="separator:ad376db0d7e809a8cc13d4618f90ba944"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a20158adb7f4c3d35c7b0f5cf19e84d2e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t CAN_message_tx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a>&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function modifies the ID field of the CAN message to be sent, according to the Kilogrid addressing scheme. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>Message to be sent </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dest</td><td>Address in Kilogrid </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 1 if succeeded. </dd></dl>

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00165">165</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa4c80db50b8633f374bfc84d9b54e51a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t get_CAN_ID_from_Kilogrid_address </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a>&#160;</td>
          <td class="paramname"><em>coord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kilogrid_8h.html#a9f1df68876fd842a165e4874cef1c85e">destination_type_t</a>&#160;</td>
          <td class="paramname"><em>dest_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute CAN ID based on the type of addressing, destination type (type of node to reach) and coordinates of the CAN node in Kilogrid. The ID field of a CAN message encodes the coordinates of the module in Kilogrid in the following manner: ID&lt;10:0&gt; = [y&lt;4:0&gt; + 1][x&lt;4:0&gt; + 1][destination_type_t] For example, when accessing module with coordinates (x = 0, y = 0) with individual addressing, ID&lt;10:0&gt; = 00001 00001 0. Zeros in the ID field are reserved for broadcasting to allmodules (00000 00000 0), modules in a row (yyyyy 00000 0), or modules in a column (00000 xxxxx 0). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td></td></tr>
    <tr><td class="paramname">coord</td><td></td></tr>
    <tr><td class="paramname">dest_type</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00035">35</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<a class="anchor" id="a75fac9f8d6e033dd6acafeece87a642a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kilogrid_8h.html#a87a8f7271d93f02214d31e4c7b90d06a">kilogrid_address_t</a> get_coord_from_CAN_ID </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00186">186</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<a class="anchor" id="a067b77d8e8a39f19e9d6b2ffdeaa3b1e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_CAN_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00084">84</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<a class="anchor" id="a84c20fe632d11f5e754c7dddbaa8b4ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_module_CAN </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>x_coord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>y_coord</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00092">92</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6c4253df4d3cec6ede0b9159d5ceb7d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serialize_tracking_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>cell_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kilogrid_8h.html#a076098c0af2ea2c910e2e870dfb07091">tracking_user_data_t</a> *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serialize CAN tracking message struct into a CAN message. The data contained in the former will be compressed according to the number of bits required for each field, and assigned to the data field of the CAN message. Note that the rest of the fields in the data message (e.g. address field) will remain untouched. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>Pointer to the CAN tracking message struct </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CAN_msg</td><td>Pointer to the CAN message that is the target of the serialization </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00227">227</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ad376db0d7e809a8cc13d4618f90ba944"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_c_a_n__message__t.html">CAN_message_t</a> CAN_rx_message</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00021">21</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa7c8bf5218a1834d935af8389e937593"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_c_a_n_8h.html#ab7565ef31c096c131e47a054c1781bc6">CAN_message_rx_t</a> module_CAN_message_rx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00019">19</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7c8192f63e3faf60e348e3ea69bd6a08"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_c_a_n_8h.html#a297b7efa86f3572af1cbb4a21216defe">CAN_message_tx_success_t</a> module_CAN_message_tx_success</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_c_a_n_8c_source.html#l00020">20</a> of file <a class="el" href="_c_a_n_8c_source.html">CAN.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
